<%= content_for(:title, t('.title')) %>
<% set_meta_tags title: @greentea.name, description: @greentea.description %>
<div class="py-3 text-center items-center">
  <div class="mx-auto px-1 py-3 sm:px-1 max-w-3xl text-center bg-secondary-focus md:rounded-3xl md:px-20">
    <!-- タグ表示 -->
    <h2 class="mb-5 py-3">
      <% @greentea.genres.each do |genre| %>
        <span class="mx-1 badge badge-accent">
          <%= genre.name %>
        </span>
      <% end %>
    </h2>
    <h1 class='font-serif text-3xl font-bold py-3'><%= @greentea.name %></h1>
    <!-- 抹茶スイーツの情報 -->
    <table class="table-fixed mb-8">
      <tbody class="w-11/12 m-auto">
        <tr>
          <td class="pl-1 pr-5 py-3 whitespace-pre-wrap text-xl font-serif text-xl font-bold align-top"><%= t('.description') %></td>
          <td class="font-sans text-sm sm:text-lg leading-relaxed"><%= @greentea.description %></td>
        </tr>
        <tr>
          <td class="pl-1 pr-5 py-3 whitespace-nowrap text-xl font-serif font-bold align-top"><%= t('.phone_number') %></td>
          <td class="font-sans text-sm sm:text-lg leading-relaxed"><%= @greentea.phone_number %></td>
        </tr>
        <tr>
          <td class="pl-1 pr-5 py-3 whitespace-nowrap text-xl font-serif  font-bold align-top"><%= t('.address') %></td>
          <td class="font-sans text-sm sm:text-lg leading-relaxed"><%= @greentea.address %></td>
        </tr>
        <tr>
          <td class="pl-1 pr-5 py-3 whitespace-nowrap text-xl font-serif text-xl font-bold align-top"><%= t('.access') %></td>
          <td class="font-sans text-sm sm:text-lg leading-relaxed"><%= @greentea.access %></td>
        </tr>
        <tr>
          <td class="pl-1 pr-5 py-3 whitespace-nowrap text-xl font-serif  font-bold align-top"><%= t('.business_hours') %></td>
          <td class="font-sans text-sm sm:text-lg leading-relaxed"><%= @greentea.business_hours %></td>
        </tr>
        <tr>
          <td class="pl-1 pr-5 py-3 whitespace-nowrap text-xl font-serif font-bold align-top"><%= t('.homepage') %></td>
          <td class="font-sans text-sm sm:text-lg custom-link"><%= link_to truncate(@greentea.homepage, length: 32), @greentea.homepage, style: 'color: blue', target: '_blank', rel: 'noopener' %></td>
        </tr>
        <tr>
          <td class="pl-1 pr-5 py-3 whitespace-nowrap text-xl font-serif font-bold align-top"><%= t('.holiday') %></td>
          <td class="font-sans text-sm sm:text-lg leading-relaxed"><%= @greentea.holiday %></td>
        </tr>
      </tbody>
    </table>
    <!-- 共有ボタン -->
    <div class="py-3">
      <%= link_to "https://twitter.com/share?url=#{request.url}%0a%0a&&text=抹茶と神社。で見付けた素敵な抹茶スイーツ店を共有します！『#{@greentea.name}』%0a%0a&&hashtags=抹茶と神社,抹茶スイーツ", target: '_blank', class: 'btn btn-sm btn-info', rel: 'noopener' do %>
        <svg class="mr-2 -ml-1 w-6 h-6" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.4 151.7c.325 4.548 .325 9.097 .325 13.65 0 138.7-105.6 298.6-298.6 298.6-59.45 0-114.7-17.22-161.1-47.11 8.447 .974 16.57 1.299 25.34 1.299 49.06 0 94.21-16.57 130.3-44.83-46.13-.975-84.79-31.19-98.11-72.77 6.498 .974 12.99 1.624 19.82 1.624 9.421 0 18.84-1.3 27.61-3.573-48.08-9.747-84.14-51.98-84.14-102.1v-1.299c13.97 7.797 30.21 12.67 47.43 13.32-28.26-18.84-46.78-51.01-46.78-87.39 0-19.49 5.197-37.36 14.29-52.95 51.65 63.67 129.3 105.3 216.4 109.8-1.624-7.797-2.599-15.92-2.599-24.04 0-57.83 46.78-104.9 104.9-104.9 30.21 0 57.5 12.67 76.67 33.14 23.72-4.548 46.46-13.32 66.6-25.34-7.798 24.37-24.37 44.83-46.13 57.83 21.12-2.273 41.58-8.122 60.43-16.24-14.29 20.79-32.16 39.31-52.63 54.25z"></path></svg>
        <div class='text-lg font-bold'>ツイッターで共有</div>
      <% end %>
      <%= link_to "http://line.me/R/msg/text/?#{@greentea.name}の詳細ページがシェアされました！%0a#{request.url}%0ali", class: 'btn btn-sm btn-success' do %>
        <svg class="mr-2 -ml-1 w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-line" viewBox="0 0 16 16"> <path d="M8 0c4.411 0 8 2.912 8 6.492 0 1.433-.555 2.723-1.715 3.994-1.678 1.932-5.431 4.285-6.285 4.645-.83.35-.734-.197-.696-.413l.003-.018.114-.685c.027-.204.055-.521-.026-.723-.09-.223-.444-.339-.704-.395C2.846 12.39 0 9.701 0 6.492 0 2.912 3.59 0 8 0ZM5.022 7.686H3.497V4.918a.156.156 0 0 0-.155-.156H2.78a.156.156 0 0 0-.156.156v3.486c0 .041.017.08.044.107v.001l.002.002.002.002a.154.154 0 0 0 .108.043h2.242c.086 0 .155-.07.155-.156v-.56a.156.156 0 0 0-.155-.157Zm.791-2.924a.156.156 0 0 0-.156.156v3.486c0 .086.07.155.156.155h.562c.086 0 .155-.07.155-.155V4.918a.156.156 0 0 0-.155-.156h-.562Zm3.863 0a.156.156 0 0 0-.156.156v2.07L7.923 4.832a.17.17 0 0 0-.013-.015v-.001a.139.139 0 0 0-.01-.01l-.003-.003a.092.092 0 0 0-.011-.009h-.001L7.88 4.79l-.003-.002a.029.029 0 0 0-.005-.003l-.008-.005h-.002l-.003-.002-.01-.004-.004-.002a.093.093 0 0 0-.01-.003h-.002l-.003-.001-.009-.002h-.006l-.003-.001h-.004l-.002-.001h-.574a.156.156 0 0 0-.156.155v3.486c0 .086.07.155.156.155h.56c.087 0 .157-.07.157-.155v-2.07l1.6 2.16a.154.154 0 0 0 .039.038l.001.001.01.006.004.002a.066.066 0 0 0 .008.004l.007.003.005.002a.168.168 0 0 0 .01.003h.003a.155.155 0 0 0 .04.006h.56c.087 0 .157-.07.157-.155V4.918a.156.156 0 0 0-.156-.156h-.561Zm3.815.717v-.56a.156.156 0 0 0-.155-.157h-2.242a.155.155 0 0 0-.108.044h-.001l-.001.002-.002.003a.155.155 0 0 0-.044.107v3.486c0 .041.017.08.044.107l.002.003.002.002a.155.155 0 0 0 .108.043h2.242c.086 0 .155-.07.155-.156v-.56a.156.156 0 0 0-.155-.157H11.81v-.589h1.525c.086 0 .155-.07.155-.156v-.56a.156.156 0 0 0-.155-.157H11.81v-.589h1.525c.086 0 .155-.07.155-.156Z" /></svg>
        <div class='text-lg font-bold'>ラインで共有</div>
      <% end %>
    </div>
    <!-- いいねボタン -->
      <% if logged_in? %>
          <%= render 'greentea_like_button', { greentea: @greentea } %>
        <% else %>
          <%= render 'shared/before_login_like' %>
        <% end %>
    <!-- 口コミボタン -->
        <%= link_to greentea_greenteacomments_path(@greentea), class: 'btn btn-wide btn-accent' do %>
        <svg class="mr-2 -ml-1 w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-chat" viewBox="0 0 16 16"> <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z" /> </svg>口コミを見る
        <% end %>
  </div>
    <!--マップ -->
    <div class="mx-auto px-1 py-3 sm:px-1 max-w-3xl items-center">
    <div id="map"></div>
    </div>
    <!-- 戻るリンク -->
      <div data-turbo="false">
        <div class='container mx-auto flex justify-center items-center py-5'>
        <%= link_to greenteas_path, class: 'btn btn-sm btn-warning-content' do %>
        <svg class="mr-2 -ml-1 w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-skip-backward-fill" viewBox="0 0 16 16"> <path d="M.5 3.5A.5.5 0 0 0 0 4v8a.5.5 0 0 0 1 0V8.753l6.267 3.636c.54.313 1.233-.066 1.233-.697v-2.94l6.267 3.636c.54.314 1.233-.065 1.233-.696V4.308c0-.63-.693-1.01-1.233-.696L8.5 7.248v-2.94c0-.63-.692-1.01-1.233-.696L1 7.248V4a.5.5 0 0 0-.5-.5z" /></svg>検索ページへ戻る
        <% end %>
        </div>
      </div>
    <!-- 近くの神社仏閣を表示する -->
    <div class="py-5">
      <h2 class='font-serif text-3xl font-bold'>近くの神社仏閣</h2>
    </div>
    <div class="py-3">
      <h2 class='font-serif text-2xl font-bold'><%= "#{@temples.count}社近くにあります" %>
    </div>
    <%= render 'shared/temple', { temple: @temple } %>
</div>

<script>
  let map;
  let greenteaMaker
  let templeMarker = []; //マーカーを複数表示させるため配列化 
  let templeWindow = []; //吹き出しを複数表示させたいので配列化
  const temples = gon.temples;

  function initMap() {
    // geocoderを初期化
    geocoder = new google.maps.Geocoder()

    map = new google.maps.Map(document.getElementById('map'), {
      // コントローラーで定義した変数から緯度経度を呼び出し、マップの中心に表示
      center: {
        lat: gon.greentea.latitude,
        lng: gon.greentea.longitude
      },
      // マップの倍率はお好みで
      zoom: 14,
    });

    greenteaMarker = new google.maps.Marker({
      // コントローラーで定義した変数から緯度経度を呼び出し、マーカーを立てる
      position: {
        lat: gon.greentea.latitude,
        lng: gon.greentea.longitude
      },
      map: map
    });

    for (let i = 0; i < temples.length; i++){
      // temples[i]は変数iのユーザーを取得している
      templeMarker[i] = new google.maps.Marker({
        map: map,
        position: {
          // DBに保存してある、緯度・経度を呼び出す
          lat: temples[i].latitude,
          lng: temples[i].longitude
        },
          icon: {
             fillColor: "#E9546B",                //塗り潰し色
             fillOpacity: 0.5,                    //塗り潰し透過率
             path: google.maps.SymbolPath.CIRCLE, //円を指定
             scale: 15,                           //円のサイズ
             strokeColor: "#E9546B",              //枠の色
             strokeWeight: 1.0                    //枠の透過率
        },
         label: {
             text: '神',                           //ラベル文字
             color: '#FFFFFF',                    //文字の色
             fontSize: '20px'                     //文字のサイズ
        }
      });

      // 変数iを変数idに代入
      let id = temples[i]['id']

      // templeWindowは吹き出し
      templeWindow[i] = new google.maps.InfoWindow({
        // contentで中身を指定
        // 今回は文字にリンクを貼り付けた形で表示
        content: `<a href='/temples/${id}'>${temples[i].name}</a>`
      });
      // markerがクリックされた時、
      templeMarker[i].addListener("click", function(){
        // infoWindowを表示
        templeWindow[i].open(map, templeMarker[i]);
      });
    }
  }

</script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=<%= ENV['GOOGLE_MAP_API'] %>&callback=initMap" async defer>
</script>

<style>
  #map {
    height: 300px;
    width: 100%;
  }
</style>
